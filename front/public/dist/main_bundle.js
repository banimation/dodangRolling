(()=>{"use strict";const e=document.getElementById("welcome"),t=document.getElementById("logout"),n=document.getElementById("same-class-user-list"),a=document.getElementById("profile-image"),d=document.getElementById("menu"),i=document.getElementById("menu-box"),s=document.getElementById("blind"),c=document.getElementById("open-my-rolling-paper"),r=document.getElementById("profile-setting-btn"),l=document.getElementById("profile-setting-container"),o=document.getElementById("profile-setting-back"),m=document.getElementById("my-profile-image"),p=document.getElementById("image-options"),g=document.getElementById("my-sky"),u=document.getElementById("my-rolling-paper-container"),h=document.getElementById("my-rp"),y=document.getElementById("letter"),E=document.getElementById("letter-title"),f=document.getElementById("letter-description"),L=document.getElementById("close"),v=document.getElementById("current-page"),I=document.getElementById("next"),B=document.getElementById("prior"),x=document.getElementById("back"),T=document.getElementById("search-input"),k=document.getElementById("search-container"),$=document.getElementById("search-user-list"),b=document.getElementById("user-sky"),w=document.getElementById("user-rp-container"),C=document.getElementById("user-back"),P=document.getElementById("user-rp"),j=document.getElementById("rolling-paper-owner"),O=document.getElementById("user-current-page"),S=document.getElementById("user-next"),N=document.getElementById("user-prior"),M=document.getElementById("write-back"),J=document.getElementById("write-btn-container"),R=document.getElementById("write-container"),D=document.getElementById("paper-title"),U=document.getElementById("paper-description"),F=document.getElementById("writer-name"),H=document.getElementById("rolling-paper-submit");let q,z,A=!1,G=!1;function K(e,t){const n=[];for(let a=0;a<e.length;a+=t){let d;d=e.slice(a,a+t),n.push(d)}return n}fetch("/verfity-date",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{e.msg&&(A=e.msg,q=e.remainingDate)})),fetch("/get-session",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((async t=>{const d=t.session;z=await d,e.innerText+=`${z.grade}-${z.group} ${z.nickName}님 반가워요!`,a.src=`/texture/profile/${z.profileImage}.png`,m.src=`/texture/profile/${z.profileImage}.png`;for(let e=0;e<11;e++){const t=document.createElement("img");t.src=`/texture/profile/${e}.png`,t.classList.add("option-images"),z.profileImage!==e&&p.append(t),t.addEventListener("click",(()=>{fetch("/change-profile-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imgNumber:e})}).then((e=>e.json())).then((t=>{"succeed"===t.msg&&(z.profileImage=e,a.src=`/texture/profile/${z.profileImage}.png`,m.src=`/texture/profile/${z.profileImage}.png`)}))}))}fetch("/get-same-class-user-data",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{e.data.forEach((e=>{if(e.uid!==z.uid){const t=document.createElement("div"),a=document.createElement("img"),d=document.createElement("div");t.classList.add("same-class-user"),a.classList.add("same-class-user-image"),a.src=`/texture/profile/${e.profileImage}.png`,d.innerText=e.nickName,e.isTeacher&&(t.style.backgroundColor="#4F59D6"),t.append(a),t.append(d),n.append(t)}}))}))}));for(let e=0;e<100;e++){const e=u.getBoundingClientRect().height,t=u.getBoundingClientRect().width,n=Math.floor(Math.random()*e),a=Math.floor(Math.random()*t),d=document.createElement("div");d.classList.add("star"),d.style.top=`${n}px`,d.style.left=`${a}px`,g.append(d)}for(let e=0;e<100;e++){const e=w.getBoundingClientRect().height,t=w.getBoundingClientRect().width,n=Math.floor(Math.random()*e),a=Math.floor(Math.random()*t),d=document.createElement("div");d.classList.add("star"),d.style.top=`${n}px`,d.style.left=`${a}px`,b.append(d)}class Q{static page=0;static maxPage=0;static async update(){h.replaceChildren();const e=K(await W(z.uid),6);Q.maxPage=e.length-1,v.innerText=`${Q.page+1}/${Q.maxPage+1}`,e[Q.page].forEach(((e,t)=>{const n=document.createElement("div"),a=document.createElement("div"),d=document.createElement("img");d.src="/texture/star.webp",a.innerText=`${e.title}`,d.classList.add("paper"),a.classList.add("rp-title"),n.classList.add("paper-container"),n.classList.add(`star${t+1}`),d.addEventListener("click",(()=>{A?(G=!0,E.innerText=`${e.title}`,f.innerText=`${e.description}`,y.classList.remove("fade-out"),y.classList.add("fade-in"),setTimeout((()=>{y.classList.remove("hidden")}),401)):alert("12월 29일 00:00에 확인 가능합니다!")})),n.append(d,a),h.append(n)}))}static next(){Q.page<Q.maxPage&&(Q.page+=1,Q.update())}static prior(){Q.page>0&&(Q.page-=1,Q.update())}}class V{static uid;static page=0;static maxPage=0;static async update(){P.replaceChildren();const e=K(await W(V.uid),6);V.maxPage=e.length-1,O.innerText=`${V.page+1}/${V.maxPage+1}`,e[V.page].forEach(((e,t)=>{const n=document.createElement("div"),a=document.createElement("div"),d=document.createElement("img");d.src="/texture/star.webp",a.innerText=`${e.title}`,d.classList.add("paper"),a.classList.add("rp-title"),n.classList.add("paper-container"),n.classList.add(`star${t+1}`),n.append(d,a),P.append(n)}))}static next(){V.page<V.maxPage&&(V.page+=1,V.update())}static prior(){V.page>0&&(V.page-=1,V.update())}static select(e){V.page=0,e&&(this.uid=e),this.update()}}const W=async e=>{let t;return await fetch("/get-user-rp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:e})}).then((e=>e.json())).then((e=>{e&&(t=e.rollingPaper)})),t};d.addEventListener("click",(()=>{s.style.visibility="visible",s.style.opacity="0.5",i.classList.remove("hidden-right")})),s.addEventListener("click",(()=>{s.style.opacity="0",i.classList.add("hidden-right"),setTimeout((()=>{s.style.visibility="hidden"}),200)})),r.addEventListener("click",(()=>{l.classList.remove("hidden-bottom")})),o.addEventListener("click",(()=>{l.classList.add("hidden-bottom")})),t.addEventListener("click",(()=>{fetch("/sign-out",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{"succeed"===e.msg&&location.reload()}))})),c.addEventListener("click",(async()=>{Q.update(),u.classList.remove("hidden-right")})),x.addEventListener("click",(()=>{u.classList.add("hidden-right"),y.classList.add("hidden")})),L.addEventListener("click",(()=>{G&&(y.classList.remove("fade-in"),y.classList.add("fade-out"),setTimeout((()=>{y.classList.add("hidden"),G=!1}),401))})),I.addEventListener("click",(()=>{Q.next()})),B.addEventListener("click",(()=>{Q.prior()})),S.addEventListener("click",(()=>{V.next()})),N.addEventListener("click",(()=>{V.prior()})),T.addEventListener("focusin",(()=>{k.classList.remove("hidden")})),T.addEventListener("focusout",(()=>{""===T.value&&k.classList.add("hidden")})),T.addEventListener("input",(()=>{const e={search:T.value};fetch("/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{J.replaceChildren(),$.replaceChildren();const t=e.data;t&&t.forEach((e=>{const t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("img"),d=document.createElement("div"),i=document.createElement("div");t.classList.add("search-user-container"),a.classList.add("search-user-image"),d.classList.add("write-rolling-paper"),i.classList.add("write-btn"),a.src=`/texture/profile/${e.profileImage}.png`,n.innerText=`${e.nickName}`,i.innerText="롤링페이퍼 써주기!",d.addEventListener("click",(async()=>{P.replaceChildren(),V.select(e.uid),j.innerText=`${e.nickName}님의 롤링페이퍼`,w.classList.remove("hidden-right")})),i.addEventListener("click",(()=>{R.classList.remove("hidden-left")}));let s=!1;JSON.parse(z.writtenUser).forEach((t=>{e.uid===t&&(s=!0)})),d.innerHTML=s?'<span class="material-symbols-outlined">edit</span>':'<span class="material-symbols-outlined">add</span>',t.append(a),t.append(n),t.append(d),$.append(t),J.append(i)}))}))})),C.addEventListener("click",(()=>{w.classList.add("hidden-right")})),M.addEventListener("click",(()=>{R.classList.add("hidden-left")})),H.addEventListener("click",(()=>{const e={paperTitle:D.value,paperDescription:U.value,author:F.value,rpOwnerUid:V.uid};fetch("/post-paper",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((async e=>{(e.msg="succeed")&&(V.update(),alert("롤링페이퍼가 전달 됐습니다!"),R.classList.add("hidden-left"))}))}))})();